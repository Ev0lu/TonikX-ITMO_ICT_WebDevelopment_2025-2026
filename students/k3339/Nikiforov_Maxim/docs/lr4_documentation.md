# Лабораторная работа 4 — Документация интерфейсов (Vue + бэкенд библиотеки)

## Введение

В рамках лабораторной работы №4 реализован клиентский веб-интерфейс на **Vue 3** (Vite) с использованием **Vuetify** для взаимодействия с серверной частью лабораторной работы №3 (Django REST Framework). Взаимодействие с API выполняется через **fetch** (без axios). На бэкенде настроен **CORS** для запросов с фронтенда.

---

## Настройка CORS на серверной части

В проекте **laboratory_work_3** (Django) подключён пакет `django-cors-headers` и в `settings.py` задано:

- **CORS_ALLOWED_ORIGINS** — разрешённые источники запросов (например, `http://localhost:5173`, `http://127.0.0.1:5173` для Vite dev-сервера).
- **CORS_ALLOW_CREDENTIALS** — `True` при необходимости отправки cookies/учётных данных.
- Middleware **CorsMiddleware** добавлен в начало списка MIDDLEWARE (перед `CommonMiddleware`).

Таким образом, браузер разрешает кросс-доменные запросы с Vue-приложения к API Django в соответствии с практической работой 3.

---

## Утверждённый список интерфейсов

Список интерфейсов (эндпоинтов API) для предметной области «библиотека» утверждён и описан в документе **[lr4_interfaces.md](lr4_interfaces.md)**. Кратко:

1. **Авторизация и учётные данные** — вход (`/auth/token/login/`), выход, текущий пользователь (`/auth/users/me/`), изменение учётных данных (PATCH `/auth/users/me/`), регистрация (POST `/auth/users/`).
2. **Читальные залы** — CRUD по `/api/reading-rooms/`.
3. **Читатели** — CRUD по `/api/readers/`, а также действия: книги читателя, старые закрепления, редкие книги, молодые читатели, статистика по образованию.
4. **Книги** — CRUD по `/api/books/`.
5. **Экземпляры книг в залах** — CRUD по `/api/book-copies/`.
6. **Закрепления книг** — CRUD по `/api/book-assignments/`, действие возврата книги.
7. **Операции библиотекаря** — регистрация читателя, исключение старых читателей, списание книги, приём книги, месячный отчёт.

Все запросы к API (кроме логина/регистрации) выполняются с заголовком `Authorization: Token <token>`.

---

## Реализованные клиентские интерфейсы

### Авторизация, регистрация и изменение учётных данных

- **Вход (Login)** — форма с полями «Имя пользователя» и «Пароль». POST на `/auth/token/login/`. Полученный токен сохраняется (например, в localStorage) и подставляется в заголовок `Authorization` при последующих запросах. При успехе выполняется переход на главную/дашборд.
- **Регистрация (Register)** — форма с полями «Имя пользователя», «Пароль», «Повтор пароля». POST на `/auth/users/` с телом `{ username, password, re_password }`. После успешной регистрации пользователь может войти через форму входа.
- **Изменение учётных данных (Профиль)** — экран «Профиль» / «Настройки» для авторизованного пользователя. GET `/auth/users/me/` для отображения текущих данных. PATCH `/auth/users/me/` для смены имени пользователя, email или пароля (при смене пароля передаётся `current_password` и при необходимости `new_password`; при использовании Djoser с повтором — `re_new_password`). Все запросы с заголовком `Authorization: Token <token>`.

Взаимодействие с серверной частью настроено в соответствии с рекомендациями (Vue.js + Django REST Framework): хранение токена, передача его в заголовке, обработка 401 для перенаправления на страницу входа.

### Основные экраны приложения

- **Главная (дашборд)** — краткая статистика (количество книг, читателей, залов, активных закреплений), получаемая через API (например, агрегация по спискам или отдельный эндпоинт, если он есть).
- **Читальные залы** — список залов (GET `/api/reading-rooms/`), создание/редактирование/удаление (POST/PATCH/PUT/DELETE), просмотр деталей зала.
- **Читатели** — список (GET `/api/readers/`), фильтр по активности, создание/редактирование читателя, просмотр деталей; отдельно — «Книги читателя» (GET `/api/readers/{id}/books/`).
- **Книги** — список (GET `/api/books/`), создание/редактирование/удаление (списание), просмотр деталей; при необходимости — связь с экземплярами в залах (`/api/book-copies/`).
- **Закрепления** — список закреплений (GET `/api/book-assignments/`), фильтр по возвращённым/не возвращённым, создание закрепления, возврат книги (POST `/api/book-assignments/{id}/return_book/`).
- **Операции библиотекаря** — вызов операций: регистрация читателя, исключение старых читателей, списание книги, приём книги; просмотр месячного отчёта (GET `/api/librarian-operations/monthly_report/?month=...&year=...`).
- **Запросы (отчёты)** — экраны для: книги заданного читателя; читатели, взявшие книгу более месяца назад; читатели с редкими книгами; количество читателей младше 20 лет; статистика по образованию в процентах — на основе эндпоинтов из раздела «Читатели» в [lr4_interfaces.md](lr4_interfaces.md).

Все запросы к API выполняются через **fetch** (единая обёртка в `shared/api` с подстановкой `Authorization: Token` и базового URL).

---

## Подключение Vuetify

В проекте **laboratory_work_4** подключена библиотека **Vuetify** (в соответствии с п. 3.1 практической работы 4.2). Используются компоненты Vuetify для форм (v-text-field, v-form, v-btn), таблиц (v-data-table), карточек (v-card), навигации (v-app-bar, v-navigation-drawer), уведомлений (v-snackbar/v-alert) и т.д. Тема и иконки (например, mdi) настроены в плагине Vuetify в `main.ts` (или в отдельном файле конфигурации плагинов).

---

## Запуск и сборка

- **Бэкенд (laboratory_work_3):**  
  `python manage.py runserver` (по умолчанию порт 8000). Убедиться, что в `CORS_ALLOWED_ORIGINS` указан адрес фронтенда (например, `http://localhost:5173`).
- **Фронтенд (laboratory_work_4):**  
  `npm run dev` — запуск dev-сервера Vite (обычно порт 5173). В `.env` или в коде задаётся переменная окружения с базовым URL API (например, `VITE_API_BASE_URL=http://localhost:8000`).

После запуска обоих частей авторизация, регистрация, изменение учётных данных и все перечисленные интерфейсы работают через утверждённый список API, описанный в [lr4_interfaces.md](lr4_interfaces.md).
